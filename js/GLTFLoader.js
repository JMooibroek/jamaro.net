import{AnimationClip as e,Bone as t,Box3 as s,BufferAttribute as r,BufferGeometry as n,CanvasTexture as a,ClampToEdgeWrapping as i,Color as o,DirectionalLight as u,DoubleSide as l,FileLoader as c,FrontSide as p,Group as h,ImageBitmapLoader as d,InterleavedBuffer as f,InterleavedBufferAttribute as m,Interpolant as v,InterpolateDiscrete as g,InterpolateLinear as T,Line as $,LineBasicMaterial as x,LineLoop as R,LineSegments as y,LinearFilter as S,LinearMipmapLinearFilter as E,LinearMipmapNearestFilter as A,Loader as M,LoaderUtils as L,Material as w,MathUtils as b,Matrix4 as I,Mesh as N,MeshBasicMaterial as O,MeshPhysicalMaterial as F,MeshStandardMaterial as C,MirroredRepeatWrapping as _,NearestFilter as H,NearestMipmapLinearFilter as U,NearestMipmapNearestFilter as P,NumberKeyframeTrack as G,Object3D as k,OrthographicCamera as D,PerspectiveCamera as B,PointLight as K,Points as j,PointsMaterial as V,PropertyBinding as X,QuaternionKeyframeTrack as q,RGBFormat as z,RepeatWrapping as W,Skeleton as Y,SkinnedMesh as Q,Sphere as J,SpotLight as Z,TangentSpaceNormalMap as ee,TextureLoader as et,TriangleFanDrawMode as es,TriangleStripDrawMode as er,Vector2 as en,Vector3 as ea,VectorKeyframeTrack as ei,sRGBEncoding as eo}from"https://cdnjs.cloudflare.com/ajax/libs/three.js/r124/three.module.min.js";var GLTFLoader=function(){function eu(e){M.call(this,e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new ed(e)}),this.register(function(e){return new em(e)}),this.register(function(e){return new ev(e)}),this.register(function(e){return new ef(e)}),this.register(function(e){return new ep(e)}),this.register(function(e){return new eg(e)})}function el(){var e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}eu.prototype=Object.assign(Object.create(M.prototype),{constructor:eu,load:function(e,t,s,r){var n,a=this;n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:L.extractUrlBase(e),this.manager.itemStart(e);var i=function(t){r?r(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new c(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(s){try{a.parse(s,n,function(s){t(s),a.manager.itemEnd(e)},i)}catch(r){i(r)}},s,i)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,s,r){var n,a={},i={};if("string"==typeof e)n=e;else if(L.decodeText(new Uint8Array(e,0,4))===eT){try{a[ec.KHR_BINARY_GLTF]=new ex(e)}catch(o){r&&r(o);return}n=a[ec.KHR_BINARY_GLTF].content}else n=L.decodeText(new Uint8Array(e));var u=JSON.parse(n);if(void 0===u.asset||u.asset.version[0]<2){r&&r(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}var l=new e0(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(var c=0;c<this.pluginCallbacks.length;c++){var p=this.pluginCallbacks[c](l);i[p.name]=p,a[p.name]=!0}if(u.extensionsUsed)for(var c=0;c<u.extensionsUsed.length;++c){var h=u.extensionsUsed[c],d=u.extensionsRequired||[];switch(h){case ec.KHR_MATERIALS_UNLIT:a[h]=new eh;break;case ec.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[h]=new e8;break;case ec.KHR_DRACO_MESH_COMPRESSION:a[h]=new eR(u,this.dracoLoader);break;case ec.KHR_TEXTURE_TRANSFORM:a[h]=new ey;break;case ec.KHR_MESH_QUANTIZATION:a[h]=new eE;break;default:d.indexOf(h)>=0&&void 0===i[h]&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(a),l.setPlugins(i),l.parse(s,r)}});var ec={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function ep(e){this.parser=e,this.name=ec.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function eh(){this.name=ec.KHR_MATERIALS_UNLIT}function ed(e){this.parser=e,this.name=ec.KHR_MATERIALS_CLEARCOAT}function ef(e){this.parser=e,this.name=ec.KHR_MATERIALS_TRANSMISSION}function em(e){this.parser=e,this.name=ec.KHR_TEXTURE_BASISU}function ev(e){this.parser=e,this.name=ec.EXT_TEXTURE_WEBP,this.isSupported=null}function eg(e){this.name=ec.EXT_MESHOPT_COMPRESSION,this.parser=e}ep.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],s=0,r=t.length;s<r;s++){var n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}},ep.prototype._loadLight=function(e){var t,s=this.parser,r="light:"+e,n=s.cache.get(r);if(n)return n;var a=s.json,i=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],l=new o(16777215);void 0!==i.color&&l.fromArray(i.color);var c=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new u(l)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new K(l)).distance=c;break;case"spot":(t=new Z(l)).distance=c,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return t.position.set(0,0,0),t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=s.createUniqueName(i.name||"light_"+e),n=Promise.resolve(t),s.cache.add(r,n),n},ep.prototype.createNodeAttachment=function(e){var t=this,s=this.parser,r=s.json.nodes[e],n=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return s._getNodeRef(t.cache,n,e)})},eh.prototype.getMaterialType=function(){return O},eh.prototype.extendParams=function(e,t,s){var r=[];e.color=new o(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var a=n.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==n.baseColorTexture&&r.push(s.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(r)},ed.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?F:null},ed.prototype.extendMaterialParams=function(e,t){var s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(s.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(s.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var i=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new en(i,-i)}return Promise.all(n)},ef.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?F:null},ef.prototype.extendMaterialParams=function(e,t){var s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)},em.prototype.loadTexture=function(e){var t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var n=r.extensions[this.name],a=s.images[n.source],i=t.options.ktx2Loader;if(!i){if(!(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,a,i)},ev.prototype.loadTexture=function(e){var t=this.name,s=this.parser,r=s.json,n=r.textures[e];if(!n.extensions||!n.extensions[t])return null;var a=n.extensions[t],i=r.images[a.source],o=s.textureLoader;if(i.uri){var u=s.options.manager.getHandler(i.uri);null!==u&&(o=u)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,i,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})},ev.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported},eg.prototype.loadBufferView=function(e){var t=this.parser.json,s=t.bufferViews[e];if(!s.extensions||!s.extensions[this.name])return null;var r=s.extensions[this.name],n=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return Promise.all([n,a.ready]).then(function(e){var t=r.byteOffset||0,s=r.byteLength||0,n=r.count,i=r.byteStride,o=new ArrayBuffer(n*i),u=new Uint8Array(e[0],t,s);return a.decodeGltfBuffer(new Uint8Array(o),n,i,u,r.mode,r.filter),o})};var eT="glTF",e$={JSON:1313821514,BIN:5130562};function ex(e){this.name=ec.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:L.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==eT)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");for(var s=this.header.length-12,r=new DataView(e,12),n=0;n<s;){var a=r.getUint32(n,!0);n+=4;var i=r.getUint32(n,!0);if(n+=4,i===e$.JSON){var o=new Uint8Array(e,12+n,a);this.content=L.decodeText(o)}else if(i===e$.BIN){var u=12+n;this.body=e.slice(u,u+a)}n+=a}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}function eR(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ec.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function ey(){this.name=ec.KHR_TEXTURE_TRANSFORM}function eS(e){C.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t={specular:{value:new o().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=t,this.onBeforeCompile=function(e){for(var s in t)e.uniforms[s]=t[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n	uniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	texelSpecular = sRGBToLinear( texelSpecular );\n	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n	specularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>","float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n	vec4 texelGlossiness = texture2D( glossinessMap, vUv );\n	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n	glossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\nmaterial.specularColor = specularFactor;")},Object.defineProperties(this,{specular:{get:function(){return t.specular.value},set:function(e){t.specular.value=e}},specularMap:{get:function(){return t.specularMap.value},set:function(e){t.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return t.glossiness.value},set:function(e){t.glossiness.value=e}},glossinessMap:{get:function(){return t.glossinessMap.value},set:function(e){t.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function e8(){return{name:ec.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio",],getMaterialType:function(){return eS},extendParams:function(e,t,s){var r=t.extensions[this.name];e.color=new o(1,1,1),e.opacity=1;var n=[];if(Array.isArray(r.diffuseFactor)){var a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==r.diffuseTexture&&n.push(s.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new o(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new o(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var i=r.specularGlossinessTexture;n.push(s.assignTexture(e,"glossinessMap",i)),n.push(s.assignTexture(e,"specularMap",i))}return Promise.all(n)},createMaterial:function(e){var t=new eS(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=ee,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function eE(){this.name=ec.KHR_MESH_QUANTIZATION}function eA(e,t,s,r){v.call(this,e,t,s,r)}eR.prototype.decodePrimitive=function(e,t){var s=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,i={},o={},u={};for(var l in a){var c=eN[l]||l.toLowerCase();i[c]=a[l]}for(l in e.attributes){var c=eN[l]||l.toLowerCase();if(void 0!==a[l]){var p=s.accessors[e.attributes[l]],h=eL[p.componentType];u[c]=h,o[c]=!0===p.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(var s in e.attributes){var r=e.attributes[s],n=o[s];void 0!==n&&(r.normalized=n)}t(e)},i,u)})})},ey.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},eS.prototype=Object.create(C.prototype),eS.prototype.constructor=eS,eS.prototype.copy=function(e){return C.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},eA.prototype=Object.create(v.prototype),eA.prototype.constructor=eA,eA.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,n=e*r*3+r,a=0;a!==r;a++)t[a]=s[n+a];return t},eA.prototype.beforeStart_=eA.prototype.copySampleValue_,eA.prototype.afterEnd_=eA.prototype.copySampleValue_,eA.prototype.interpolate_=function(e,t,s,r){for(var n=this.resultBuffer,a=this.sampleValues,i=this.valueSize,o=2*i,u=3*i,l=r-t,c=(s-t)/l,p=c*c,h=p*c,d=e*u,f=d-u,m=-2*h+3*p,v=h-p,g=1-m,T=v-p+c,$=0;$!==i;$++){var x=a[f+$+i],R=a[f+$+o]*l,y=a[d+$+i],S=a[d+$]*l;n[$]=g*x+T*R+m*y+v*S}return n};var eM={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},eL={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ew={9728:H,9729:S,9984:P,9985:A,9986:U,9987:E},eb={33071:i,33648:_,10497:W},eI={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eN={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},eO={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},eF={CUBICSPLINE:void 0,LINEAR:T,STEP:g},eC={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function e_(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:t+e}function eH(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new C({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:p})),e.DefaultMaterial}function eU(e,t,s){for(var r in s.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=s.extensions[r])}function eP(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function eG(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var s=0,r=t.weights.length;s<r;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var s=0,r=n.length;s<r;s++)e.morphTargetDictionary[n[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ek(e){var t,s=e.extensions&&e.extensions[ec.KHR_DRACO_MESH_COMPRESSION];return s?"draco:"+s.bufferView+":"+s.indices+":"+eD(s.attributes):e.indices+":"+eD(e.attributes)+":"+e.mode}function eD(e){for(var t="",s=Object.keys(e).sort(),r=0,n=s.length;r<n;r++)t+=s[r]+":"+e[s[r]]+";";return t}function e0(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.cache=new el,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new d(this.options.manager):this.textureLoader=new et(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new c(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function eB(e,t,r){var n=t.attributes,a=[];function i(t,s){return r.getDependency("accessor",t).then(function(t){e.setAttribute(s,t)})}for(var o in n){var u=eN[o]||o.toLowerCase();u in e.attributes||a.push(i(n[o],u))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});a.push(l)}return eP(e,t),!function e(t,r,n){var a=r.attributes,i=new s;if(void 0!==a.POSITION){var o=n.json.accessors[a.POSITION],u=o.min,l=o.max;if(void 0!==u&&void 0!==l)i.set(new ea(u[0],u[1],u[2]),new ea(l[0],l[1],l[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}var c=r.targets;if(void 0!==c){for(var p=new ea,h=new ea,d=0,f=c.length;d<f;d++){var m=c[d];if(void 0!==m.POSITION){var o=n.json.accessors[m.POSITION],u=o.min,l=o.max;void 0!==u&&void 0!==l?(h.setX(Math.max(Math.abs(u[0]),Math.abs(l[0]))),h.setY(Math.max(Math.abs(u[1]),Math.abs(l[1]))),h.setZ(Math.max(Math.abs(u[2]),Math.abs(l[2]))),p.max(h)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(p)}t.boundingBox=i;var v=new J;i.getCenter(v.center),v.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=v}}(e,t,r),Promise.all(a).then(function(){return void 0!==t.targets?function e(t,s,r){for(var n=!1,a=!1,i=0,o=s.length;i<o;i++){var u=s[i];if(void 0!==u.POSITION&&(n=!0),void 0!==u.NORMAL&&(a=!0),n&&a)break}if(!n&&!a)return Promise.resolve(t);for(var l=[],c=[],i=0,o=s.length;i<o;i++){var u=s[i];if(n){var p=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):t.attributes.position;l.push(p)}if(a){var p=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):t.attributes.normal;c.push(p)}}return Promise.all([Promise.all(l),Promise.all(c)]).then(function(e){var s=e[0],r=e[1];return n&&(t.morphAttributes.position=s),a&&(t.morphAttributes.normal=r),t.morphTargetsRelative=!0,t})}(e,t.targets,r):e})}function eK(e,t){var s=e.getIndex();if(null===s){var r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<n.count;a++)r.push(a);e.setIndex(r),s=e.getIndex()}var i=s.count-2,o=[];if(t===es)for(var a=1;a<=i;a++)o.push(s.getX(0)),o.push(s.getX(a)),o.push(s.getX(a+1));else for(var a=0;a<i;a++)a%2==0?(o.push(s.getX(a)),o.push(s.getX(a+1)),o.push(s.getX(a+2))):(o.push(s.getX(a+2)),o.push(s.getX(a+1)),o.push(s.getX(a)));o.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(o),u}return e0.prototype.setExtensions=function(e){this.extensions=e},e0.prototype.setPlugins=function(e){this.plugins=e},e0.prototype.parse=function(e,t){var s=this,r=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera"),])}).then(function(t){var a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:s,userData:{}};eU(n,a,r),eP(a,r),Promise.all(s._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){e(a)})}).catch(t)},e0.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[],r=0,n=t.length;r<n;r++)for(var a=t[r].joints,i=0,o=a.length;i<o;i++)e[a[i]].isBone=!0;for(var u=0,l=e.length;u<l;u++){var c=e[u];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(s[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},e0.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},e0.prototype._getNodeRef=function(e,t,s){if(e.refs[t]<=1)return s;var r=s.clone();return r.name+="_instance_"+e.uses[t]++,r},e0.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var s=0;s<t.length;s++){var r=e(t[s]);if(r)return r}},e0.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var s=[],r=0;r<t.length;r++){var n=e(t[r]);n&&s.push(n)}return s},e0.prototype.getDependency=function(e,t){var s=e+":"+t,r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw Error("Unknown type: "+e)}this.cache.add(s,r)}return r},e0.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var s=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,r){return s.getDependency(e,r)})),this.cache.add(e,t)}return t},e0.prototype.loadBuffer=function(e){var t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[ec.KHR_BINARY_GLTF].body);var r=this.options;return new Promise(function(e,n){s.load(e_(t.uri,r.path),e,void 0,function(){n(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},e0.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var s=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+s)})},e0.prototype.loadAccessor=function(e){var t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then(function(e){var a,i,o=e[0],u=eI[n.type],l=eL[n.componentType],c=l.BYTES_PER_ELEMENT,p=n.byteOffset||0,h=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;if(h&&h!==c*u){var v=Math.floor(p/h),g="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+v+":"+n.count,T=t.cache.get(g);T||(a=new l(o,v*h,n.count*h/c),T=new f(a,h/c),t.cache.add(g,T)),i=new m(T,u,p%h/c,d)}else a=null===o?new l(n.count*u):new l(o,p,n.count*u),i=new r(a,u,d);if(void 0!==n.sparse){var $=eI.SCALAR,x=eL[n.sparse.indices.componentType],R=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,S=new x(e[1],R,n.sparse.count*$),E=new l(e[2],y,n.sparse.count*u);null!==o&&(i=new r(i.array.slice(),i.itemSize,i.normalized));for(var A=0,M=S.length;A<M;A++){var L=S[A];if(i.setX(L,E[A*u]),u>=2&&i.setY(L,E[A*u+1]),u>=3&&i.setZ(L,E[A*u+2]),u>=4&&i.setW(L,E[A*u+3]),u>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},e0.prototype.loadTexture=function(e){var t=this.json,s=this.options,r=t.textures[e],n=t.images[r.source],a=this.textureLoader;if(n.uri){var i=s.manager.getHandler(n.uri);null!==i&&(a=i)}return this.loadTextureImage(e,n,a)},e0.prototype.loadTextureImage=function(e,t,s){var r=this,n=this.json,i=this.options,o=n.textures[e],u=self.URL||self.webkitURL,l=t.uri,c=!1,p=!0;if("image/jpeg"===t.mimeType&&(p=!1),void 0!==t.bufferView)l=r.getDependency("bufferView",t.bufferView).then(function(e){if("image/png"===t.mimeType){var s=new DataView(e,25,1).getUint8(0,!1);p=6===s||4===s||3===s}c=!0;var r=new Blob([e],{type:t.mimeType});return l=u.createObjectURL(r)});else if(void 0===t.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(l).then(function(e){return new Promise(function(t,r){var n=t;!0===s.isImageBitmapLoader&&(n=function(e){t(new a(e))}),s.load(e_(e,i.path),n,void 0,r)})}).then(function(t){!0===c&&u.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name),p||(t.format=z);var s=(n.samplers||{})[o.sampler]||{};return t.magFilter=ew[s.magFilter]||S,t.minFilter=ew[s.minFilter]||E,t.wrapS=eb[s.wrapS]||W,t.wrapT=eb[s.wrapT]||W,r.associations.set(t,{type:"textures",index:e}),t})},e0.prototype.assignTexture=function(e,t,s){var r=this;return this.getDependency("texture",s.index).then(function(n){if(void 0===s.texCoord||0==s.texCoord||"aoMap"===t&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),r.extensions[ec.KHR_TEXTURE_TRANSFORM]){var a=void 0!==s.extensions?s.extensions[ec.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var i=r.associations.get(n);n=r.extensions[ec.KHR_TEXTURE_TRANSFORM].extendTexture(n,a),r.associations.set(n,i)}}e[t]=n})},e0.prototype.assignFinalMaterial=function(e){var t=e.geometry,s=e.material,r=void 0!==t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal,i=!0===e.isSkinnedMesh,o=Object.keys(t.morphAttributes).length>0,u=o&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+s.uuid,c=this.cache.get(l);c||(c=new V,w.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(l,c)),s=c}else if(e.isLine){var l="LineBasicMaterial:"+s.uuid,p=this.cache.get(l);p||(p=new x,w.prototype.copy.call(p,s),p.color.copy(s.color),this.cache.add(l,p)),s=p}if(r||n||a||i||o){var l="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),i&&(l+="skinning:"),r&&(l+="vertex-tangents:"),n&&(l+="vertex-colors:"),a&&(l+="flat-shading:"),o&&(l+="morph-targets:"),u&&(l+="morph-normals:");var h=this.cache.get(l);h||(h=s.clone(),i&&(h.skinning=!0),n&&(h.vertexColors=!0),a&&(h.flatShading=!0),o&&(h.morphTargets=!0),u&&(h.morphNormals=!0),r&&(h.vertexTangents=!0,h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(l,h),this.associations.set(h,this.associations.get(s))),s=h}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s},e0.prototype.getMaterialType=function(){return C},e0.prototype.loadMaterial=function(e){var t,s=this,r=this.json,n=this.extensions,a=r.materials[e],i={},u=a.extensions||{},c=[];if(u[ec.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=n[ec.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=p.getMaterialType(),c.push(p.extendParams(i,a,s))}else if(u[ec.KHR_MATERIALS_UNLIT]){var h=n[ec.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),c.push(h.extendParams(i,a,s))}else{var d=a.pbrMetallicRoughness||{};if(i.color=new o(1,1,1),i.opacity=1,Array.isArray(d.baseColorFactor)){var f=d.baseColorFactor;i.color.fromArray(f),i.opacity=f[3]}void 0!==d.baseColorTexture&&c.push(s.assignTexture(i,"map",d.baseColorTexture)),i.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,i.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(s.assignTexture(i,"metalnessMap",d.metallicRoughnessTexture)),c.push(s.assignTexture(i,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,i)})))}!0===a.doubleSided&&(i.side=l);var m=a.alphaMode||eC.OPAQUE;return m===eC.BLEND?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,m===eC.MASK&&(i.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==O&&(c.push(s.assignTexture(i,"normalMap",a.normalTexture)),i.normalScale=new en(1,-1),void 0!==a.normalTexture.scale&&i.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==O&&(c.push(s.assignTexture(i,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(i.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==O&&(i.emissive=new o().fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==O&&c.push(s.assignTexture(i,"emissiveMap",a.emissiveTexture)),Promise.all(c).then(function(){var r;return r=t===eS?n[ec.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new t(i),a.name&&(r.name=a.name),r.map&&(r.map.encoding=eo),r.emissiveMap&&(r.emissiveMap.encoding=eo),eP(r,a),s.associations.set(r,{type:"materials",index:e}),a.extensions&&eU(n,r,a),r})},e0.prototype.createUniqueName=function(e){for(var t=X.sanitizeNodeName(e||""),s=t,r=1;this.nodeNamesUsed[s];++r)s=t+"_"+r;return this.nodeNamesUsed[s]=!0,s},e0.prototype.loadGeometries=function(e){var t=this,s=this.extensions,r=this.primitiveCache;function a(e){return s[ec.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(s){return eB(s,e,t)})}for(var i=[],o=0,u=e.length;o<u;o++){var l,c=e[o],p=ek(c),h=r[p];h?i.push(h.promise):(l=c.extensions&&c.extensions[ec.KHR_DRACO_MESH_COMPRESSION]?a(c):eB(new n,c,t),r[p]={primitive:c,promise:l},i.push(l))}return Promise.all(i)},e0.prototype.loadMesh=function(e){for(var t=this,s=this.json,r=this.extensions,n=s.meshes[e],a=n.primitives,i=[],o=0,u=a.length;o<u;o++){var l=void 0===a[o].material?eH(this.cache):this.getDependency("material",a[o].material);i.push(l)}return i.push(t.loadGeometries(a)),Promise.all(i).then(function(s){for(var i=s.slice(0,s.length-1),o=s[s.length-1],u=[],l=0,c=o.length;l<c;l++){var p,d=o[l],f=a[l],m=i[l];if(f.mode===eM.TRIANGLES||f.mode===eM.TRIANGLE_STRIP||f.mode===eM.TRIANGLE_FAN||void 0===f.mode)!0!==(p=!0===n.isSkinnedMesh?new Q(d,m):new N(d,m)).isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),f.mode===eM.TRIANGLE_STRIP?p.geometry=eK(p.geometry,er):f.mode===eM.TRIANGLE_FAN&&(p.geometry=eK(p.geometry,es));else if(f.mode===eM.LINES)p=new y(d,m);else if(f.mode===eM.LINE_STRIP)p=new $(d,m);else if(f.mode===eM.LINE_LOOP)p=new R(d,m);else if(f.mode===eM.POINTS)p=new j(d,m);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);Object.keys(p.geometry.morphAttributes).length>0&&eG(p,n),p.name=t.createUniqueName(n.name||"mesh_"+e),eP(p,n),f.extensions&&eU(r,p,f),t.assignFinalMaterial(p),u.push(p)}if(1===u.length)return u[0];for(var v=new h,l=0,c=u.length;l<c;l++)v.add(u[l]);return v})},e0.prototype.loadCamera=function(e){var t,s=this.json.cameras[e],r=s[s.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===s.type?t=new B(b.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===s.type&&(t=new D(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),eP(t,s),Promise.resolve(t)},e0.prototype.loadSkin=function(e){var t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return s.inverseBindMatrices=e,s})},e0.prototype.loadAnimation=function(t){for(var s=this.json.animations[t],r=[],n=[],a=[],i=[],o=[],u=0,l=s.channels.length;u<l;u++){var c=s.channels[u],p=s.samplers[c.sampler],h=c.target,d=void 0!==h.node?h.node:h.id,f=void 0!==s.parameters?s.parameters[p.input]:p.input,m=void 0!==s.parameters?s.parameters[p.output]:p.output;r.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",f)),a.push(this.getDependency("accessor",m)),i.push(p),o.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(a),Promise.all(i),Promise.all(o)]).then(function(r){for(var n=r[0],a=r[1],i=r[2],o=r[3],u=r[4],l=[],c=0,p=n.length;c<p;c++){var h=n[c],d=a[c],f=i[c],m=o[c],v=u[c];if(void 0!==h){switch(h.updateMatrix(),h.matrixAutoUpdate=!0,eO[v.path]){case eO.weights:y=G;break;case eO.rotation:y=q;break;case eO.position:case eO.scale:default:y=ei}var g=h.name?h.name:h.uuid,$=void 0!==m.interpolation?eF[m.interpolation]:T,x=[];eO[v.path]===eO.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)}):x.push(g);var R=f.array;if(f.normalized){if(R.constructor===Int8Array)S=1/127;else if(R.constructor===Uint8Array)S=1/255;else if(R.constructor==Int16Array)S=1/32767;else if(R.constructor===Uint16Array)S=1/65535;else throw Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var y,S,E=new Float32Array(R.length),A=0,M=R.length;A<M;A++)E[A]=R[A]*S;R=E}for(var A=0,M=x.length;A<M;A++){var L=new y(x[A]+"."+eO[v.path],d.array,R,$);"CUBICSPLINE"===m.interpolation&&(L.createInterpolant=function e(t){return new eA(this.times,this.values,this.getValueSize()/3,t)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(L)}}}var w=s.name?s.name:"animation_"+t;return new e(w,void 0,l)})},e0.prototype.loadNode=function(e){var s,r=this.json,n=this.extensions,a=this,i=r.nodes[e],o=i.name?a.createUniqueName(i.name):"";return(s=[],void 0!==i.mesh&&s.push(a.getDependency("mesh",i.mesh).then(function(e){var t=a._getNodeRef(a.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})),void 0!==i.camera&&s.push(a.getDependency("camera",i.camera).then(function(e){return a._getNodeRef(a.cameraCache,i.camera,e)})),a._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){s.push(e)}),Promise.all(s)).then(function(s){var r;if((r=!0===i.isBone?new t:s.length>1?new h:1===s.length?s[0]:new k)!==s[0])for(var u=0,l=s.length;u<l;u++)r.add(s[u]);if(i.name&&(r.userData.name=i.name,r.name=o),eP(r,i),i.extensions&&eU(n,r,i),void 0!==i.matrix){var c=new I;c.fromArray(i.matrix),r.applyMatrix4(c)}else void 0!==i.translation&&r.position.fromArray(i.translation),void 0!==i.rotation&&r.quaternion.fromArray(i.rotation),void 0!==i.scale&&r.scale.fromArray(i.scale);return a.associations.set(r,{type:"nodes",index:e}),r})},e0.prototype.loadScene=function(){function e(t,s,r,n){var a=r.nodes[t];return n.getDependency("node",t).then(function(e){var t;return void 0===a.skin?e:n.getDependency("skin",a.skin).then(function(e){t=e;for(var s=[],r=0,a=t.joints.length;r<a;r++)s.push(n.getDependency("node",t.joints[r]));return Promise.all(s)}).then(function(s){return e.traverse(function(e){if(e.isMesh){for(var r=[],n=[],a=0,i=s.length;a<i;a++){var o=s[a];if(o){r.push(o);var u=new I;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*a),n.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new Y(r,n),e.matrixWorld)}}),e})}).then(function(t){s.add(t);var i=[];if(a.children)for(var o=a.children,u=0,l=o.length;u<l;u++){var c=o[u];i.push(e(c,t,r,n))}return Promise.all(i)})}return function t(s){var r=this.json,n=this.extensions,a=this.json.scenes[s],i=new h;a.name&&(i.name=this.createUniqueName(a.name)),eP(i,a),a.extensions&&eU(n,i,a);for(var o=a.nodes||[],u=[],l=0,c=o.length;l<c;l++)u.push(e(o[l],i,r,this));return Promise.all(u).then(function(){return i})}}(),eu}();export{GLTFLoader};